# Dev Prompt — Story 11.1 (Drive-integrated CT-S3 runner + deterministic reports)

## Source of truth

- Story: `_bmad-output/implementation-artifacts/11-1-drive-integrated-ct-s3-runner-with-explicit-audience-model-and-deterministic-reports.md`
- Sprint 0 order: `_bmad-output/planning-artifacts/development-order.md`
- Context / non-negotiables: `_bmad-output/project-context.md` (Docker-first; SeaweedFS baseline; no-leak)
- Related stories to reuse/align:
  - Story 2.1/2.2 edge contract docs + Nginx reference config (audience model)
  - Story 11.2 SeaweedFS baseline profile encoded
  - Story 11.3 safe evidence allow-listing (no-leak by construction)
- Failure classes glossary: `docs/failure-class-glossary.md`

## Goal (Story 11.1)

Implement a **Drive-integrated S3 contract test runner (CT-S3)** that:

- is **audience-aware**: `INTERNAL_PROXY` vs `EXTERNAL_BROWSER`
- encodes and reports **connect_url vs signed_host** invariants explicitly
- produces **deterministic artifacts** (human + machine readable) under
  `_bmad-output/implementation-artifacts/`
- remains **no-leak** (never prints secrets, signed URLs, or SigV4 headers)

## Non-negotiables

- Docker-first baseline; **SeaweedFS is the blocking baseline profile**.
- Proxy-agnostic: tests must not couple to a specific reverse proxy.
- Deterministic output: stable keys, stable ordering, stable filenames.
- No-leak: safe evidence only (status codes, request IDs, hashes; never secrets,
  credentials, or full object keys/paths).

## Expected implementation shape (high level)

- Provide a single, documented entrypoint to run CT-S3 locally and in CI
  (e.g. a script, a management command, or a Make target) — follow the story.
- Model provider profiles (SeaweedFS baseline + optional fixtures) explicitly.
- Emit a deterministic report including:
  - audience: `INTERNAL_PROXY` / `EXTERNAL_BROWSER`
  - checks list with `failure_class` + `next_action_hint`
  - safe evidence only
  - `latest.txt` pointer update

## Verification (dev-owned; record in run report)

- At least one intentional failure scenario produces deterministic artifacts
  without leaks.

## CI / PR policy (this fork)

Do not wait for these non-blocking checks:

- Docker Hub Workflow / build-and-push-backend
- Docker Hub Workflow / build-and-push-frontend
- Update crowdin sources / synchronize-with-crowdin
- Frontend Workflow / test-e2e (chromium/firefox/webkit)

## Traceability (required)

- Create `_bmad-output/implementation-artifacts/runs/<YYYYMMDD-HHMMSS>-11.1/`
  with `report.md`, `commands.log`, `files-changed.txt`, `gates.md`
- Update `_bmad-output/implementation-artifacts/latest.txt`
- Update `_bmad-output/implementation-artifacts/sprint-status.yaml`
  (11.1: ready-for-dev → in-progress → review/done)
- Fill “Dev Agent Record” in the Story 11.1 file with the run link

